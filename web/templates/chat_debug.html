<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O-RedMind Chat Debug</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
</head>
<body>
    <div class="container-fluid">
        <div class="row h-100">
            <div class="col-12">
                <h2>üêõ O-RedMind Chat Debug</h2>
                
                <div class="card">
                    <div class="card-body" id="chatMessages" style="height: 400px; overflow-y: auto;">
                        <p class="text-muted">Messages appara√Ætront ici...</p>
                    </div>
                    
                    <div class="card-footer">
                        <div class="input-group">
                            <input type="text" class="form-control" id="messageInput" 
                                   placeholder="Tapez votre message..." value="Test message">
                            <button class="btn btn-outline-secondary" type="button" onclick="testUpload()">
                                <i class="fas fa-paperclip"></i> Upload
                            </button>
                            <button class="btn btn-primary" type="button" onclick="testSendMessage()">
                                <i class="fas fa-paper-plane"></i> Envoyer
                            </button>
                        </div>
                        
                        <input type="file" id="fileInput" style="display: none;">
                        
                        <div class="mt-2">
                            <small id="status">Status: Chargement...</small>
                        </div>
                    </div>
                </div>
                
                <div class="mt-3">
                    <h5>Tests de Debug</h5>
                    <button class="btn btn-info btn-sm" onclick="testAlert()">Test Alert</button>
                    <button class="btn btn-warning btn-sm" onclick="testSocket()">Test Socket</button>
                    <button class="btn btn-success btn-sm" onclick="testElements()">Test Elements</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales de debug
        let socket = null;
        let isConnected = false;
        
        // Tests de base
        function testAlert() {
            alert('‚úÖ JavaScript fonctionne !');
        }
        
        function testElements() {
            const messageInput = document.getElementById('messageInput');
            const fileInput = document.getElementById('fileInput');
            const status = document.getElementById('status');
            
            console.log('Elements trouv√©s:', {
                messageInput: messageInput,
                fileInput: fileInput,
                status: status
            });
            
            status.textContent = `Elements: messageInput=${!!messageInput}, fileInput=${!!fileInput}`;
        }
        
        function testSocket() {
            console.log('Test Socket:', {socket, isConnected});
            document.getElementById('status').textContent = `Socket: ${!!socket}, Connected: ${isConnected}`;
        }
        
        function testUpload() {
            alert('üìé Upload bouton cliqu√© !');
            const fileInput = document.getElementById('fileInput');
            if (fileInput) {
                fileInput.click();
            } else {
                alert('‚ùå FileInput non trouv√©');
            }
        }
        
        function testSendMessage() {
            alert('üì§ Send bouton cliqu√© !');
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                const message = messageInput.value.trim();
                alert(`Message: "${message}"`);
                
                if (socket && isConnected) {
                    socket.emit('send_message', {
                        message: message,
                        modality: 'text',
                        attachments: []
                    });
                    
                    // Affichage du message localement
                    const chatMessages = document.getElementById('chatMessages');
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'alert alert-primary';
                    messageDiv.textContent = `Vous: ${message}`;
                    chatMessages.appendChild(messageDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    messageInput.value = '';
                } else {
                    alert('‚ùå Socket non connect√©');
                }
            } else {
                alert('‚ùå MessageInput non trouv√©');
            }
        }
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOM charg√©');
            document.getElementById('status').textContent = 'DOM charg√©, connexion Socket.IO...';
            
            // Initialisation Socket.IO
            socket = io();
            
            socket.on('connect', function() {
                isConnected = true;
                document.getElementById('status').textContent = '‚úÖ Connect√© au serveur';
                console.log('‚úÖ Socket.IO connect√©');
            });
            
            socket.on('disconnect', function() {
                isConnected = false;
                document.getElementById('status').textContent = '‚ùå D√©connect√© du serveur';
                console.log('‚ùå Socket.IO d√©connect√©');
            });
            
            socket.on('error', function(data) {
                console.error('‚ùå Erreur Socket.IO:', data);
                document.getElementById('status').textContent = `‚ùå Erreur: ${data.message}`;
            });
            
            // Test d'√©coute des r√©ponses
            socket.on('ai_response', function(data) {
                console.log('ü§ñ R√©ponse IA re√ßue:', data);
                const chatMessages = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'alert alert-success';
                messageDiv.textContent = `IA: ${data.message.content}`;
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            });
            
            socket.on('message_received', function(data) {
                console.log('üì® Message re√ßu:', data);
            });
            
            // Test automatique au chargement
            setTimeout(testElements, 1000);
        });
        
        // Event listener pour Enter
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.target.id === 'messageInput') {
                e.preventDefault();
                testSendMessage();
            }
        });
    </script>
</body>
</html>